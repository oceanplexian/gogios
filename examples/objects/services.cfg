###############################################################################
# Services
###############################################################################


# ===========================================================================
# gogios-server - Local system checks (all hit localhost, all should pass)
# ===========================================================================

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     PING
    check_command           check_ping!100!500
}

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     Root Partition
    check_command           check_disk!/!80!90
}

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     Current Load
    check_command           check_load!5!10
}

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     Total Processes
    check_command           check_procs!250!400
}

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     Swap Usage
    check_command           check_swap!50!80
}

define service {
    use                     generic-service
    host_name               gogios-server
    service_description     SSH
    check_command           check_ssh!5
}


# ===========================================================================
# google-dns - External connectivity checks
# ===========================================================================

define service {
    use                     generic-service
    host_name               google-dns
    service_description     PING
    check_command           check_ping!50!200
}

define service {
    use                     generic-service
    host_name               google-dns
    service_description     DNS Resolution
    check_command           check_dns!google.com
    notes                   Verifies external DNS resolution is working
}


# ===========================================================================
# web-01 - Web server checks
# Will produce real results: PING will be OK (it's localhost), HTTP will
# go CRITICAL unless you have something listening on port 80. Perfect
# for watching the state machine do its thing.
# ===========================================================================

define service {
    use                     generic-service
    host_name               web-01
    service_description     PING
    check_command           check_ping!100!500
}

define service {
    use                     critical-service
    host_name               web-01
    service_description     HTTP
    check_command           check_http!2!5
    event_handler           handle-service-event
    notes                   Will go CRITICAL if nothing listens on :80. Start a web server to see it recover.
}

define service {
    use                     critical-service
    host_name               web-01
    service_description     HTTPS
    check_command           check_tcp!443!5
    notes                   Will go CRITICAL if nothing listens on :443.
}

define service {
    use                     generic-service
    host_name               web-01
    service_description     SSH
    check_command           check_ssh!5
}


# ===========================================================================
# db-01 - Database server checks
# PostgreSQL port check will fail unless pg is actually running on :5432.
# ===========================================================================

define service {
    use                     generic-service
    host_name               db-01
    service_description     PING
    check_command           check_ping!100!500
}

define service {
    use                     critical-service
    host_name               db-01
    service_description     PostgreSQL Port
    check_command           check_tcp!5432!5
    notes                   Will go CRITICAL if PostgreSQL is not running on :5432.
}

define service {
    use                     generic-service
    host_name               db-01
    service_description     SSH
    check_command           check_ssh!5
}


# ===========================================================================
# dead-host - Services on the unreachable host
# These will also fail, and their notifications will be suppressed because
# the parent host is DOWN. That's the dependency system in action.
# ===========================================================================

define service {
    use                     generic-service
    host_name               dead-host
    service_description     PING
    check_command           check_ping!100!500
}

define service {
    use                     generic-service
    host_name               dead-host
    service_description     SSH
    check_command           check_ssh!5
}

define service {
    use                     generic-service
    host_name               dead-host
    service_description     HTTP
    check_command           check_http!2!5
}


# ===========================================================================
# Passive check example - Backup status
# No active check runs. Feed results via the external command pipe:
#
#   echo "[$(date +%s)] PROCESS_SERVICE_CHECK_RESULT;gogios-server;Backup Status;0;Backup OK - completed in 23 min" > var/rw/gogios.cmd
#
# If no result arrives within freshness_threshold (3600s), the service
# goes stale and reports UNKNOWN.
# ===========================================================================

define service {
    use                     passive-service
    host_name               gogios-server
    service_description     Backup Status
    contact_groups          admins
    freshness_threshold     3600
    notes                   Submit results via command pipe. Goes stale after 1 hour with no update.
}
